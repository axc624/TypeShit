<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>TypeShit Daily</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      margin: 40px 0 90px;
      padding: 0 12px;
    }

    h1 { margin: 0 0 8px; font-size: 34px; }
    .hint { opacity: 0.75; margin: 0 0 10px; line-height: 1.35; }
    #status { opacity: 0.85; margin-top: 8px; }

    .columns {
      display: flex;
      justify-content: center;
      gap: 14px;
      margin: 20px 0;
    }

    .column {
      width: 84px;
      cursor: pointer;
      user-select: none;
      touch-action: none;
    }

    .wheel {
      position: relative;
      height: 210px;
      overflow: hidden;
      border-radius: 14px;
      background: #1b1b1b;
      border: 1px solid #333;
      box-shadow: 0 8px 22px rgba(0,0,0,0.35);
    }

    .wheel::after {
      content: "";
      position: absolute;
      left: 0; right: 0;
      top: 70px;
      height: 70px;
      background: rgba(255,255,255,0.08);
      border-top: 1px solid rgba(255,255,255,0.15);
      border-bottom: 1px solid rgba(255,255,255,0.15);
      pointer-events: none;
    }

    .strip {
      position: absolute;
      width: 100%;
      transition: transform 420ms cubic-bezier(.22,1.2,.36,1);
      will-change: transform;
    }

    .cell {
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 44px;
      font-weight: 900;
      letter-spacing: 0.6px;
      color: #f5f5f5;
    }

    button {
      padding: 10px 16px;
      font-size: 18px;
      border-radius: 10px;
      border: none;
      background: #4CAF50;
      color: white;
      cursor: pointer;
      margin-top: 10px;
    }

    #result {
      margin-top: 12px;
      font-size: 20px;
      min-height: 28px;
    }

    #found {
      max-width: 760px;
      margin: 14px auto 0;
      text-align: left;
    }

    .pillwrap {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .pill {
      background: #222;
      border: 1px solid #333;
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 900;
    }

    /* Mobile shrink */
    @media (max-width: 430px) {
      .columns { gap: 10px; }
      .column { width: 64px; }
      .wheel { height: 168px; }
      .wheel::after { top: 56px; height: 56px; }
      .cell { height: 56px; font-size: 34px; }
      button { font-size: 16px; }
    }

    /* Win overlay */
    #overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.65);
    }

    #overlay.show { display: flex; }

    .modal {
      background: #141414;
      border: 1px solid #2a2a2a;
      border-radius: 16px;
      padding: 20px;
      max-width: 400px;
      width: 90%;
    }
  </style>
</head>

<body>

<h1>TypeShit Daily</h1>
<p class="hint">Swipe or scroll. Middle row makes the word.</p>

<div class="columns" id="columns"></div>

<button onclick="submitWord()">Submit</button>

<p id="result"></p>
<div id="status"></div>
<div id="found"></div>

<div id="overlay">
  <div class="modal">
    <h2>ðŸŽ‰ You Solved It!</h2>
    <p id="winText"></p>
    <button onclick="closeOverlay()">Close</button>
  </div>
</div>

<script>
const wordLength = 5;
const lettersPool = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
let ROW_H = 70;
const ACTIVE_ROW = 1;
const RING_LEN = 11;

const TARGET_MIN_SOLUTIONS = 8;
const TARGET_MAX_SOLUTIONS = 25;
const SEED_WORD_COUNT = 12;

const columnsDiv = document.getElementById("columns");
const resultEl = document.getElementById("result");
const statusEl = document.getElementById("status");
const foundEl = document.getElementById("found");
const overlay = document.getElementById("overlay");
const winText = document.getElementById("winText");

const cols = [];
let DICT_LIST = [];
let SOLUTIONS = new Set();
let FOUND = new Set();

function syncRowHeight() {
  const cell = document.querySelector(".cell");
  if (cell) ROW_H = cell.getBoundingClientRect().height;
}

function dayKey() {
  return new Intl.DateTimeFormat("en-CA", {
    timeZone: "America/Los_Angeles",
    year: "numeric",
    month: "2-digit",
    day: "2-digit"
  }).format(new Date());
}

function hash(str){
  let h=2166136261;
  for(let i=0;i<str.length;i++){
    h^=str.charCodeAt(i);
    h=Math.imul(h,16777619);
  }
  return h>>>0;
}

function rng(seed){
  return function(){
    seed+=0x6D2B79F5;
    let t=Math.imul(seed^seed>>>15,1|seed);
    t^=t+Math.imul(t^t>>>7,61|t);
    return ((t^t>>>14)>>>0)/4294967296;
  }
}

function currentWord(){
  return cols.map(c=>{
    const idx=(c.offset+ACTIVE_ROW)%c.ring.length;
    return c.ring[idx];
  }).join("").toLowerCase();
}

function render(i){
  const c=cols[i];
  c.strip.style.transform=`translateY(-${c.offset*ROW_H}px)`;
}

function shift(i,dir){
  const c=cols[i];
  c.offset=(c.offset+dir+c.ring.length)%c.ring.length;
  render(i);
  autoSubmit();
}

function buildColumn(i){
  const col=document.createElement("div");
  col.className="column";

  const wheel=document.createElement("div");
  wheel.className="wheel";

  const strip=document.createElement("div");
  strip.className="strip";

  const ring=Array.from({length:RING_LEN},()=> "A");

  ring.forEach(ch=>{
    const cell=document.createElement("div");
    cell.className="cell";
    cell.textContent=ch;
    strip.appendChild(cell);
  });

  wheel.appendChild(strip);
  col.appendChild(wheel);
  columnsDiv.appendChild(col);

  cols[i]={ring,offset:0,strip};

  col.addEventListener("wheel",e=>{
    e.preventDefault();
    shift(i,e.deltaY>0?1:-1);
  },{passive:false});

  col.addEventListener("click",()=>shift(i,1));
}

async function loadDictionary(){
  const res=await fetch("words.txt");
  const text=await res.text();
  DICT_LIST=text.split(/\r?\n/)
    .map(w=>w.trim().toLowerCase())
    .filter(w=>w.length===wordLength);
}

function computeSolutions(sets){
  const sols=new Set();
  for(const w of DICT_LIST){
    let ok=true;
    for(let i=0;i<wordLength;i++){
      if(!sets[i].has(w[i].toUpperCase())){ok=false;break;}
    }
    if(ok)sols.add(w);
  }
  return sols;
}

function generatePuzzle(){
  const seed=hash("TypeShitDaily|"+dayKey());
  const random=rng(seed);

  let sets;
  let sols;

  for(let t=0;t<40;t++){
    sets=Array.from({length:wordLength},()=>new Set());
    for(let s=0;s<SEED_WORD_COUNT;s++){
      const w=DICT_LIST[Math.floor(random()*DICT_LIST.length)];
      for(let i=0;i<wordLength;i++)
        sets[i].add(w[i].toUpperCase());
    }
    sols=computeSolutions(sets);
    if(sols.size>=TARGET_MIN_SOLUTIONS && sols.size<=TARGET_MAX_SOLUTIONS) break;
  }

  SOLUTIONS=sols;
  FOUND=new Set();

  for(let i=0;i<wordLength;i++){
    const allowed=[...sets[i]];
    const c=cols[i];
    for(let k=0;k<RING_LEN;k++){
      c.ring[k]=allowed[Math.floor(random()*allowed.length)];
    }
    c.offset=Math.floor(random()*RING_LEN);
    render(i);
  }

  statusEl.textContent=`Daily ${dayKey()} â€¢ ${SOLUTIONS.size} words`;
  renderFound();
}

function autoSubmit(){
  const w=currentWord();
  if(SOLUTIONS.has(w) && !FOUND.has(w)){
    FOUND.add(w);
    renderFound();
    if(FOUND.size===SOLUTIONS.size){
      winText.textContent=`All ${SOLUTIONS.size} words found!`;
      overlay.classList.add("show");
    }
  }
}

function submitWord(){
  autoSubmit();
}

function renderFound(){
  const words=[...FOUND].sort();
  foundEl.innerHTML=words.length
    ? `<div class="pillwrap">${words.map(w=>`<span class="pill">${w.toUpperCase()}</span>`).join("")}</div>`
    : "";
}

function closeOverlay(){
  overlay.classList.remove("show");
}

window.closeOverlay=closeOverlay;

async function init(){
  for(let i=0;i<wordLength;i++) buildColumn(i);
  syncRowHeight();
  window.addEventListener("resize",()=>{
    syncRowHeight();
    cols.forEach((_,i)=>render(i));
  });
  await loadDictionary();
  generatePuzzle();
}

init();
</script>

</body>
</html>
