<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>TypeShift Daily</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
  text-align: center;
  margin: 40px 0 90px;
  padding: 0 12px;
}
h1 { margin: 0 0 8px; font-size: 34px; }
.hint { opacity: 0.75; margin: 0 0 10px; }
#status { opacity: 0.9; margin-top: 8px; min-height: 22px; }

.columns {
  display: flex;
  justify-content: center;
  gap: 14px;
  margin: 20px 0;
}

.column {
  width: 84px;
  cursor: pointer;
  user-select: none;
  touch-action: none;
}

.wheel {
  position: relative;
  height: 210px;
  overflow: hidden;
  border-radius: 14px;
  background: #1b1b1b;
  border: 1px solid #333;
}

.wheel::after {
  content: "";
  position: absolute;
  left: 0; right: 0;
  top: 70px;
  height: 70px;
  background: rgba(255,255,255,0.08);
}

.strip {
  position: absolute;
  width: 100%;
  transition: transform 420ms cubic-bezier(.22,1.2,.36,1);
}

.cell {
  height: 70px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 44px;
  font-weight: 900;
}

.actions { margin-top: 8px; }

button {
  padding: 10px 16px;
  font-size: 18px;
  border-radius: 10px;
  border: none;
  background: #4CAF50;
  color: white;
  cursor: pointer;
}
button.secondary { background: #2a2a2a; border: 1px solid #3a3a3a; }

#result { margin-top: 12px; font-size: 20px; }

.pillwrap { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:12px; }
.pill { background:#222; padding:6px 10px; border-radius:999px; font-weight:900; }

@media (max-width: 430px) {
  .column { width: 64px; }
  .wheel { height: 168px; }
  .wheel::after { top: 56px; height: 56px; }
  .cell { height: 56px; font-size: 34px; }
}
</style>
</head>

<body>
<h1>TypeShift Daily</h1>
<p class="hint">Swipe or scroll. Middle row forms the word.</p>

<div class="columns" id="columns"></div>

<div class="actions">
<button onclick="submitWord()">Submit</button>
<button class="secondary" onclick="resetToday()">Reset</button>
</div>

<p id="result"></p>
<div id="status"></div>
<div id="found"></div>

<script>

// ---------------- CONFIG ----------------
const wordLength = 5;
const ROWS = 5; // number of words per puzzle

let ROW_H = 70;
const ACTIVE_ROW = 1;

const columnsDiv = document.getElementById("columns");
const resultEl = document.getElementById("result");
const statusEl = document.getElementById("status");
const foundEl = document.getElementById("found");

const cols = [];
let DICT_LIST = [];
let DICT_SET = new Set();
let SOLUTIONS = new Set();
let FOUND = new Set();

// ---------------- UTIL ----------------
function hashStringToUint32(str){
  let h=2166136261;
  for(let i=0;i<str.length;i++){
    h^=str.charCodeAt(i);
    h=Math.imul(h,16777619);
  }
  return h>>>0;
}
function mulberry32(seed){
  return function(){
    let t=(seed+=0x6D2B79F5);
    t=Math.imul(t^(t>>>15),t|1);
    t^=t+Math.imul(t^(t>>>7),t|61);
    return ((t^(t>>>14))>>>0)/4294967296;
  }
}
function dayKey(){
  return new Intl.DateTimeFormat("en-CA",{timeZone:"America/Los_Angeles"}).format(new Date());
}

// ---------------- DICTIONARY ----------------
async function loadDictionary(){
  const res = await fetch("words.txt",{cache:"no-store"});
  const text = await res.text();

  DICT_LIST = text.split(/\r?\n/)
    .map(w=>w.trim().toLowerCase())
    .filter(w=>w.length===wordLength && /^[a-z]+$/.test(w));

  DICT_SET = new Set(DICT_LIST);
  statusEl.textContent=`Loaded ${DICT_LIST.length} words`;
}

// ---------------- COLUMN UI ----------------
function buildColumn(i){
  const col=document.createElement("div");
  col.className="column";

  const wheel=document.createElement("div");
  wheel.className="wheel";

  const strip=document.createElement("div");
  strip.className="strip";

  const cells=[];
  for(let r=0;r<3;r++){
    const cell=document.createElement("div");
    cell.className="cell";
    strip.appendChild(cell);
    cells.push(cell);
  }

  wheel.appendChild(strip);
  col.appendChild(wheel);
  columnsDiv.appendChild(col);

  cols[i]={list:["A"],index:0,strip,cells};

  col.addEventListener("wheel",(e)=>{
    e.preventDefault();
    shift(i,e.deltaY>0?1:-1);
  },{passive:false});

  col.addEventListener("click",()=>shift(i,1));
  renderColumn(i,false);
}

function renderColumn(i){
  const c=cols[i];
  const top=c.index-1;
  const mid=c.index;
  const bot=c.index+1;

  c.cells[0].textContent=(top>=0)?c.list[top]:"";
  c.cells[1].textContent=c.list[mid]||"";
  c.cells[2].textContent=(bot<c.list.length)?c.list[bot]:"";
}

function shift(i,dir){
  const c=cols[i];
  const max=c.list.length-1;
  c.index=Math.max(0,Math.min(max,c.index+dir));
  renderColumn(i);
  showCurrentWord();
}

// ---------------- GAME LOGIC ----------------
function currentWord(){
  return cols.map(c=>c.list[c.index]).join("").toLowerCase();
}

function showCurrentWord(){
  resultEl.textContent="Current: "+currentWord().toUpperCase();
}

function renderFound(){
  foundEl.innerHTML=`
    <div class="pillwrap">
      ${Array.from(FOUND).map(w=>`<span class="pill">${w.toUpperCase()}</span>`).join("")}
    </div>`;
}

function submitWord(){
  const w=currentWord();
  if(!SOLUTIONS.has(w)){
    resultEl.textContent="❌ Not valid";
    return;
  }
  if(FOUND.has(w)){
    resultEl.textContent="↩ Already found";
    return;
  }
  FOUND.add(w);
  resultEl.textContent="✅ Found "+w.toUpperCase();
  renderFound();
}

// ---------------- TRUE TYPESHIFT GENERATOR ----------------
function generatePuzzle(){
  const seed=hashStringToUint32("TypeShift|"+dayKey());
  const rng=mulberry32(seed);

  const shuffled=[...DICT_LIST].sort(()=>rng()-0.5);
  const chosen=shuffled.slice(0,ROWS);

  SOLUTIONS=new Set(chosen);
  FOUND=new Set();

  for(let i=0;i<wordLength;i++){
    const colLetters=chosen.map(w=>w[i].toUpperCase());

    for(let a=colLetters.length-1;a>0;a--){
      const j=Math.floor(rng()*(a+1));
      [colLetters[a],colLetters[j]]=[colLetters[j],colLetters[a]];
    }

    cols[i].list=colLetters;
    cols[i].index=Math.floor(rng()*colLetters.length);
    renderColumn(i);
  }

  showCurrentWord();
  renderFound();
}

// ---------------- INIT ----------------
async function init(){
  for(let i=0;i<wordLength;i++) buildColumn(i);
  await loadDictionary();
  generatePuzzle();
}
init();

</script>
</body>
</html>
